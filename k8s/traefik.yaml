apiVersion: v1
kind: List
items:
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: traefik-ingress-controller
    namespace: panos-mcp-service
- kind: ClusterRole
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: traefik-panos-mcp-controller
  rules:
    - apiGroups:
        - ""
      resources:
        - services
        - endpoints
        - secrets
      verbs:
        - get
        - list
        - watch
    - apiGroups:
        - extensions
        - networking.k8s.io
      resources:
        - ingresses
        - ingressclasses
      verbs:
        - get
        - list
        - watch
    - apiGroups:
        - extensions
        - networking.k8s.io
      resources:
        - ingresses/status
      verbs:
        - update
    - apiGroups:
        - traefik.containo.us
        - traefik.io
      resources:
        - middlewares
        - middlewaretcps
        - ingressroutes
        - traefikservices
        - ingressroutetcps
        - ingressrouteudps
        - tlsoptions
        - tlsstores
        - serverstransports
      verbs:
        - get
        - list
        - watch
- kind: ClusterRoleBinding
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: traefik-panos-mcp-controller
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: traefik-panos-mcp-controller
  subjects:
    - kind: ServiceAccount
      name: traefik-ingress-controller
      namespace: panos-mcp-service
- apiVersion: v1
  kind: Service
  metadata:
    name: traefik
    namespace: panos-mcp-service
    annotations:
      metallb.universe.tf/specific-address: "10.0.0.53"
  spec:
    ports:
      - name: web
        protocol: TCP
        port: 80
        targetPort: web
      - name: websecure
        protocol: TCP
        port: 443
        targetPort: websecure
      - name: admin
        protocol: TCP
        port: 9000
        targetPort: admin
    selector:
      app: traefik
    type: LoadBalancer
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: traefik
    namespace: panos-mcp-service
    labels:
      app: traefik
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: traefik
    template:
      metadata:
        labels:
          app: traefik
      spec:
        serviceAccountName: traefik-ingress-controller
        containers:
          - name: traefik
            image: traefik:v2.10
            args:
              - "--api.dashboard=true"
              - "--providers.kubernetesingress"
              - "--providers.kubernetescrd"
              - "--entrypoints.web.address=:80"
              - "--entrypoints.websecure.address=:443"
              - "--entrypoints.admin.address=:9000"
              - "--api.insecure=true"
              - "--log.level=DEBUG"
            ports:
              - name: web
                containerPort: 80
              - name: websecure
                containerPort: 443
              - name: admin
                containerPort: 9000
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
